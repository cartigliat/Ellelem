<UserControl x:Class="ollamidesk.RAG.Views.DocumentLibraryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:ollamidesk" mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="300">

	<UserControl.Resources>
		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
		<local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
		<local:StatusColorConverter x:Key="StatusColorConverter"/>
	</UserControl.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

        <TextBlock Text="Document Library" Grid.Row="0" Margin="10"
                   FontSize="{StaticResource HeaderFontSize}" FontWeight="Bold"
                   Style="{StaticResource {x:Type TextBlock}}"/>

		<ListView Grid.Row="1"
                  ItemsSource="{Binding Documents}"
                  Margin="10"
                  Style="{StaticResource {x:Type ListView}}"
                  HorizontalContentAlignment="Stretch"> <!-- Ensure items stretch -->
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Background="{StaticResource SecondaryBackgroundBrush}"
                            BorderBrush="{StaticResource BorderColorBrush}"
                            BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/> <!-- CheckBox -->
                                <ColumnDefinition Width="*"/>   <!-- Details -->
                                <ColumnDefinition Width="Auto"/> <!-- Actions -->
                            </Grid.ColumnDefinitions>

                            <!-- Column 0: Selection CheckBox -->
                            <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                      IsEnabled="{Binding IsProcessed}" VerticalAlignment="Center" Margin="0,0,10,0"
                                      Style="{StaticResource {x:Type CheckBox}}"/>

                            <!-- Column 1: Document Details -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="{StaticResource BaseFontSize}" Foreground="{StaticResource PrimaryForegroundBrush}" TextTrimming="CharacterEllipsis"/>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <TextBlock Text="Type: " FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource SecondaryForegroundBrush}"/>
                                    <TextBlock Text="{Binding DocumentType}" FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource SecondaryForegroundBrush}" Margin="0,0,10,0"/>
                                    <TextBlock Text="Size: " FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource SecondaryForegroundBrush}"/>
                                    <TextBlock Text="{Binding FileSizeDisplay}" FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource SecondaryForegroundBrush}"/>
                                </StackPanel>
                                <!-- Status Indicators -->
                                <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsProcessing}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>
                                    <TextBlock Text="âœ”ï¸" Foreground="LightGreen" FontSize="{StaticResource BaseFontSize}" ToolTip="Processed"
                                               Visibility="{Binding IsProcessed, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    <TextBlock Text="âšª" Foreground="{StaticResource SecondaryForegroundBrush}" FontSize="{StaticResource BaseFontSize}" ToolTip="Not Processed"
                                               Visibility="{Binding IsProcessed, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                    <TextBlock Text="{Binding Status}" Margin="5,0,0,0" FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource SecondaryForegroundBrush}" VerticalAlignment="Center"/>
                                </StackPanel>
                                <!-- Processing Indicator -->
                                <StackPanel Orientation="Horizontal" Margin="0,3,0,0" VerticalAlignment="Center"
                                            Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <ProgressBar IsIndeterminate="True" Width="50" Height="10" Margin="0,0,5,0" Style="{StaticResource {x:Type ProgressBar}}"/>
                                    <TextBlock Text="Processing..." FontSize="{StaticResource SmallFontSize}" Foreground="{StaticResource AccentColor1Brush}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Column 2: Action Buttons -->
                            <StackPanel Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Right">
                                <Button Command="{Binding ProcessCommand}" ToolTip="Process Document"
                                        Visibility="{Binding IsProcessed, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                        Style="{StaticResource {x:Type Button}}" Padding="5" Margin="0,0,0,3">
                                    <TextBlock Text="â–¶ï¸" FontSize="14"/> <!-- Process Icon -->
                                </Button>
                                <Button Command="{Binding DeleteCommand}" ToolTip="Delete Document"
                                        Style="{StaticResource {x:Type Button}}" Padding="5">
                                    <TextBlock Text="ðŸ—‘ï¸" FontSize="14"/> <!-- Delete Icon -->
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10">
            <Button Command="{Binding AddDocumentCommand}" Padding="8,5" Style="{StaticResource {x:Type Button}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="âž•" Margin="0,0,5,0" VerticalAlignment="Center"/> <!-- Add Icon -->
                    <TextBlock Text="Add Document" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding RefreshCommand}" Margin="10,0,0,0" Padding="8,5" Style="{StaticResource {x:Type Button}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ”„" Margin="0,0,5,0" VerticalAlignment="Center"/> <!-- Refresh Icon -->
                    <TextBlock Text="Refresh" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <Border Grid.RowSpan="3"
                Background="#A01E1E1E" <!-- Semi-transparent PrimaryBackgroundBrush -->
                Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Working..." Foreground="{StaticResource PrimaryForegroundBrush}" FontSize="16" Margin="0,0,0,10"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="10" Style="{StaticResource {x:Type ProgressBar}}"/>
            </StackPanel>
        </Border>
	</Grid>
</UserControl>