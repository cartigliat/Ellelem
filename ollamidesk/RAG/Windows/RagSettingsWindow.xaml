<Window x:Class="ollamidesk.RAG.Windows.RagSettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="RAG Configuration" Height="Auto" Width="550" MinWidth="400" MinHeight="400" MaxHeight="600" SizeToContent="Height"
        Style="{StaticResource {x:Type Window}}"
        WindowStartupLocation="CenterOwner">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="RAG Configuration" Grid.Row="0" Margin="0,0,0,20"
                   FontSize="{StaticResource HeaderFontSize}" FontWeight="Bold"
                   Style="{StaticResource {x:Type TextBlock}}"/>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel>

                <GroupBox Header="Retrieval Parameters" Margin="0,0,0,10" Style="{StaticResource {x:Type GroupBox}}">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" MinWidth="120"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Max Chunks Retrieved:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource {x:Type TextBlock}}"/>
                        <Slider Grid.Row="0" Grid.Column="1" Minimum="1" Maximum="20" Value="{Binding MaxRetrievedChunks}"
                                TickFrequency="1" IsSnapToTickEnabled="True" TickPlacement="BottomRight" Margin="5,0" Style="{StaticResource {x:Type Slider}}"/>
                        <TextBox Grid.Row="0" Grid.Column="2" Width="60" Text="{Binding MaxRetrievedChunks}" Style="{StaticResource {x:Type TextBox}}"/>

                        <TextBlock Text="Min Similarity Score:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,10,10,0" Style="{StaticResource {x:Type TextBlock}}"/>
                        <Slider Grid.Row="1" Grid.Column="1" Minimum="0" Maximum="1" Value="{Binding MinSimilarityScore}"
                                TickFrequency="0.05" TickPlacement="BottomRight" Margin="5,10,5,0" Style="{StaticResource {x:Type Slider}}"/>
                        <TextBox Grid.Row="1" Grid.Column="2" Width="60" Text="{Binding MinSimilarityScore, StringFormat=N2}" Margin="0,10,0,0" Style="{StaticResource {x:Type TextBox}}"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Chunking Parameters" Margin="0,10,0,10" Style="{StaticResource {x:Type GroupBox}}">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" MinWidth="120"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Chunk Size (Tokens):" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource {x:Type TextBlock}}"/>
                        <Slider Grid.Row="0" Grid.Column="1" Minimum="100" Maximum="2000" Value="{Binding ChunkSize}"
                                TickFrequency="100" IsSnapToTickEnabled="True" TickPlacement="BottomRight" Margin="5,0" Style="{StaticResource {x:Type Slider}}"/>
                        <TextBox Grid.Row="0" Grid.Column="2" Width="60" Text="{Binding ChunkSize}" Style="{StaticResource {x:Type TextBox}}"/>

                        <TextBlock Text="Chunk Overlap (Tokens):" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,10,10,0" Style="{StaticResource {x:Type TextBlock}}"/>
                        <Slider Grid.Row="1" Grid.Column="1" Minimum="0" Maximum="500" Value="{Binding ChunkOverlap}"
                                TickFrequency="25" IsSnapToTickEnabled="True" TickPlacement="BottomRight" Margin="5,10,5,0" Style="{StaticResource {x:Type Slider}}"/>
                        <TextBox Grid.Row="1" Grid.Column="2" Width="60" Text="{Binding ChunkOverlap}" Margin="0,10,0,0" Style="{StaticResource {x:Type TextBox}}"/>
                    </Grid>
                </GroupBox>

                <GroupBox Header="Advanced Parameters" Margin="0,10,0,10" Style="{StaticResource {x:Type GroupBox}}">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" MinWidth="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Semantic Chunking:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,10,0" Style="{StaticResource {x:Type TextBlock}}"/>
                        <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding UseSemanticChunking}" VerticalAlignment="Center" Style="{StaticResource ModernToggleSwitchStyle}" ToolTip="Enable semantic chunking for more context-aware document splitting."/>
                    </Grid>
                </GroupBox>

                <TextBlock TextWrapping="Wrap" Margin="0,10,0,5" FontStyle="Italic" Foreground="{StaticResource SecondaryForegroundBrush}" Style="{StaticResource {x:Type TextBlock}}">
                    Note: Changes to these settings will affect future document processing but won't
                    automatically reprocess existing documents. You may need to delete and re-add documents
                    for changes to Chunking or Semantic Chunking to apply.
                </TextBlock>

                <TextBlock TextWrapping="Wrap" Margin="0,5,0,0" FontStyle="Italic" Foreground="{StaticResource AccentColor1Brush}" Style="{StaticResource {x:Type TextBlock}}" FontSize="{StaticResource SmallFontSize}">
                    Model generation parameters (Temperature, Top-P) are now accessible in the main chat window
                    under "Model Settings" and affect all responses immediately.
                </TextBlock>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Reset Defaults" Command="{Binding ResetCommand}" Padding="10,5" Margin="0,0,10,0" MinWidth="100" Style="{StaticResource {x:Type Button}}"/>
            <Button Content="Save" Command="{Binding SaveCommand}" IsDefault="True" Padding="20,5" Margin="0,0,10,0" MinWidth="80" Style="{StaticResource {x:Type Button}}"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}" IsCancel="True" Padding="10,5" MinWidth="80" Style="{StaticResource {x:Type Button}}"/>
        </StackPanel>
    </Grid>
</Window>